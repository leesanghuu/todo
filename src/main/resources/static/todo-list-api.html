<!DOCTYPE html>
<html>
<head>
    <title>ğŸ“Œ Todo List </title>
    <meta charset="UTF-8">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome (ì•„ì´ì½˜) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- jQuery ì¶”ê°€ (AJAX ì‚¬ìš©) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .fa-edit, .fa-times, .fa-check {
            font-size: 1.0rem;
            cursor: pointer;
        }
        .edit-input {
            display: none;
            width: 60%;
        }
        .completed {
            text-decoration: line-through;
            color: gray;
        }
    </style>
</head>
<body>

<section class="vh-100" style="background-color: #e2d5de;">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col col-xl-10">
                <div class="card" style="border-radius: 15px;">
                    <div class="card-body p-5">

                        <h6 class="mb-3 text-center">ğŸ“ŒTodo List</h6>

                        <!-- í•  ì¼ ì¶”ê°€ í¼ -->
                        <form class="d-flex justify-content-center align-items-center mb-4" onsubmit="addTodo(event)">
                            <div class="form-outline flex-fill">
                                <input type="text" id="new-todo" class="form-control form-control-lg" required />
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg ms-2">Add</button>
                        </form>

                        <!-- í•  ì¼ ëª©ë¡ -->
                        <ul id="todo-list" class="list-group mb-0"></ul>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    $(document).ready(function(){
        loadTodos();
    });

    // âœ… í•  ì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadTodos() {
        $.get("/api/todos", function (data) {
            $("#todo-list").empty();
            data.forEach(todo => {
                $("#todo-list").append(renderTodoItem(todo));
            });
        });
    }

    // âœ… í•  ì¼ ì¶”ê°€
    function addTodo(event) {
        event.preventDefault();
        let newTodoTitle = $("#new-todo").val();

        $.ajax({
            type: "POST",
            url: "/api/todos",
            contentType: "application/json",
            data: JSON.stringify({ title: newTodoTitle, completed: false }),
            success: function(todo) {
                $("#todo-list").append(renderTodoItem(todo));
                $("#new-todo").val("");
            }
        });
    }

    // âœ… í•  ì¼ ìˆ˜ì •
    function updateTodo(id) {
        let newTitle = $("#edit-" + id).val();

        $.ajax({
            type: "PUT",
            url: `/api/todos/${id}`,
            contentType: "application/json",
            data: JSON.stringify({ title: newTitle }),
            success: function () {
                $("#title-" + id).text(newTitle).show();
                $("#edit-" + id).hide();
                $(".edit-btn[data-id='" + id + "']").show(); // ìˆ˜ì • ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
                $(".save-btn[data-id='" + id + "']").hide(); // ì²´í¬ ë²„íŠ¼ ìˆ¨ê¹€
            }
        });
    }

    // âœ… ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ (ì²´í¬ ë²„íŠ¼ í‘œì‹œ)
    function enableEdit(id) {
        $("#title-" + id).hide();
        $("#edit-" + id).show().focus();
        $(".edit-btn[data-id='" + id + "']").hide();
        $(".save-btn[data-id='" + id + "']").show(); // ì²´í¬ ë²„íŠ¼ í‘œì‹œ
    }

    // âœ… í•  ì¼ í† ê¸€ (ì™„ë£Œ/ë¯¸ì™„ë£Œ ë³€ê²½)
    function toggleTodo(id) {
        $.ajax({
            type: "PATCH",
            url: `/api/todos/${id}/toggle`,
            success: function(todo) {
                $("#title-" + id).toggleClass("completed", todo.completed);
            }
        });
    }

    // âœ… í•  ì¼ ì‚­ì œ
    function deleteTodo(id) {
        $.ajax({
            type: "DELETE",
            url: `/api/todos/${id}`,
            success: function() {
                $("#todo-" + id).remove();
            }
        });
    }

    // âœ… í•  ì¼ ëª©ë¡ ë Œë”ë§ (ì²´í¬ ë²„íŠ¼ ê¸°ë³¸ ìˆ¨ê¹€)
    function renderTodoItem(todo) {
        return `
            <li id="todo-${todo.id}" class="list-group-item d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <input class="form-check-input me-2" type="checkbox" ${todo.completed ? "checked" : ""} onclick="toggleTodo(${todo.id})" />
                    <span id="title-${todo.id}" class="${todo.completed ? "completed" : ""}">${todo.title}</span>
                    <input type="text" id="edit-${todo.id}" class="edit-input form-control form-control-sm" value="${todo.title}" style="display:none;">
                </div>
                <div>
                    <i class="fas fa-edit text-success me-3 edit-btn" data-id="${todo.id}" onclick="enableEdit(${todo.id})"></i>
                    <i class="fas fa-check text-primary me-3 save-btn" data-id="${todo.id}" onclick="updateTodo(${todo.id})" style="display: none;"></i>
                    <i class="fas fa-times text-danger" onclick="deleteTodo(${todo.id})"></i>
                </div>
            </li>
        `;
    }
</script>

</body>
</html>