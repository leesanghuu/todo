<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ğŸ“Œ Todo List</title>
    <meta charset="UTF-8">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome (ì•„ì´ì½˜) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- jQuery ì¶”ê°€ (AJAX ì‚¬ìš©) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .fa-edit, .fa-times, .fa-check {
            font-size: 1.0rem;
            cursor: pointer;
        }
        .edit-input {
            display: none;
            width: 60%;
        }
        .completed {
            text-decoration: line-through;
            color: gray;
        }
    </style>
</head>
<body>

<section class="vh-100" style="background-color: #e2d5de;">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col col-xl-10">

                <div class="card" style="border-radius: 15px;">
                    <div class="card-body p-5">

                        <h6 class="mb-3 text-center">ğŸ“Œ ìƒí›„ì˜ Todo List</h6>

                        <!-- í•  ì¼ ì¶”ê°€ í¼ -->
                        <form class="d-flex justify-content-center align-items-center mb-4" th:action="@{/add}" method="post">
                            <div class="form-outline flex-fill">
                                <input type="text" id="form3" class="form-control form-control-lg" name="title" required />
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg ms-2">Add</button>
                        </form>

                        <!-- í•  ì¼ ëª©ë¡ -->
                        <ul class="list-group mb-0">
                            <li th:each="todo : ${todos}"
                                class="list-group-item d-flex justify-content-between align-items-center border-start-0 border-top-0 border-end-0 border-bottom rounded-0 mb-2">

                                <div class="d-flex align-items-center">
                                    <!-- ì™„ë£Œ ì²´í¬ë°•ìŠ¤ -->
                                    <input class="form-check-input me-2" type="checkbox" th:checked="${todo.completed}"
                                           th:data-id="${todo.id}" />

                                    <!-- ìˆ˜ì • ê°€ëŠ¥í•œ ì œëª© ì˜ì—­ -->
                                    <span class="todo-title" th:text="${todo.title}" th:id="'title-'+${todo.id}"></span>
                                    <input type="text" class="edit-input form-control form-control-sm" th:id="'edit-'+${todo.id}" th:value="${todo.title}">

                                </div>

                                <!-- ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼ -->
                                <div>
                                    <i class="fas fa-edit text-success me-3 edit-btn" th:data-id="${todo.id}"></i>
                                    <i class="fas fa-check text-primary me-3 save-btn" th:data-id="${todo.id}" style="display: none;"></i>
                                    <a th:href="@{/delete/{id}(id=${todo.id})}" class="text-danger">
                                        <i class="fas fa-times"></i>
                                    </a>
                                </div>

                            </li>
                        </ul>

                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

<script>
    $(document).ready(function(){
        // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ
        $(".edit-btn").click(function(){
            var id = $(this).attr("data-id");
            $("#title-" + id).hide();  // ê¸°ì¡´ ì œëª© ìˆ¨ê¸°ê¸°
            $("#edit-" + id).show().focus();  // ìˆ˜ì • ì…ë ¥ì°½ í‘œì‹œ
            $(this).hide();  // ìˆ˜ì • ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            $(".save-btn[data-id='" + id + "']").show();  // ì €ì¥ ë²„íŠ¼ í‘œì‹œ
        });

        // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ
        $(".save-btn").click(function(){
            var id = $(this).attr("data-id");
            var newTitle = $("#edit-" + id).val();  // ìƒˆë¡œìš´ ì œëª© ê°€ì ¸ì˜¤ê¸°

            $.ajax({
                type: "PUT",
                url: "/update",
                contentType: "application/x-www-form-urlencoded",
                data: { id: id, title: newTitle },
                success: function(response){
                    if(response === "success"){
                        $("#title-" + id).text(newTitle).show();  // ë³€ê²½ëœ ì œëª© í‘œì‹œ
                        $("#edit-" + id).hide();  // ìˆ˜ì • ì…ë ¥ì°½ ìˆ¨ê¸°ê¸°
                        $(".edit-btn[data-id='" + id + "']").show();  // ìˆ˜ì • ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
                        $(".save-btn[data-id='" + id + "']").hide();  // ì €ì¥ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                    }
                },
                error: function (xhr, status, error) {
                    console.error("í•  ì¼ ìˆ˜ì • ì‹¤íŒ¨: ", error)
                }
            });
        });

        // Enter í‚¤ ì…ë ¥ ì‹œ ì €ì¥
        $(".edit-input").keypress(function(e){
            if(e.which === 13){  // Enter í‚¤
                var id = $(this).attr("id").split('-')[1];  // ID ì¶”ì¶œ
                $(".save-btn[data-id='" + id + "']").click();  // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì‹¤í–‰
            }
        });
        // ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ì™„ë£Œ ìƒíƒœ í† ê¸€ (ì·¨ì†Œì„  ì¶”ê°€/ì œê±°)
        $(".form-check-input").change(function(){
            var id = $(this).attr("data-id");
            var titleElement = $("#title-" + id); // ì œëª© ìš”ì†Œ

            // ì¦‰ì‹œ ì·¨ì†Œì„  ì ìš©
            titleElement.toggleClass("completed");

            // ì„œë²„ì— ë³€ê²½ ì‚¬í•­ ì „ì†¡
            $.ajax({
                type: "GET",
                url: "/toggle/" + id,
                success: function(response){
                    console.log("ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì„±ê³µ:", response);
                },
                error: function(xhr, status, error) {
                    console.error("ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:", error);
                }
            });
        });
    });
</script>

</body>
</html>